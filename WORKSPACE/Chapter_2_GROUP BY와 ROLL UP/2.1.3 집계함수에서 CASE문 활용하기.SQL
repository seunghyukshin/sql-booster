-- 주문테이블에서 주문년월별로 '계좌이체건수'와 '카드결제건수'를 조회하는 SQL을 작성하라


SELECT TO_CHAR(ORD_DT, 'YYYYMM')
     , PAY_TP
     , COUNT(1)
FROM T_ORD
WHERE ORD_ST = 'COMP'
GROUP BY TO_CHAR(ORD_DT, 'YYYYMM'), PAY_TP
ORDER BY 1;

-- NICE RESULT
SELECT TO_CHAR(ORD_DT, 'YYYYMM')
        , SUM(CASE WHEN PAY_TP ='BANK' THEN 1 END) AS 계좌이체건수
        , SUM(CASE WHEN PAY_TP ='CARD' THEN 1 END) AS 카드결제건수
FROM T_ORD
WHERE ORD_ST = 'COMP'
GROUP BY TO_CHAR(ORD_DT, 'YYYYMM')
ORDER BY 1;
;

-- 지불유형을 세로(ROW)로 나오게 하고 주문년월을 가로(컬럼)로 표시해봐라.
SELECT *
FROM (SELECT TO_CHAR(ORD_DT, 'YYYYMM') AS ORD_YM, PAY_TP
      FROM T_ORD
      WHERE ORD_ST = 'COMP')
    PIVOT (
    SUM(1) FOR ORD_YM IN ('201701','201702','201703','201704','201705', '201706', '201707', '201708', '201709', '201710', '201711', '201712' )
    )
;

-- NICE ? I DON'T THINK SO
SELECT T1.PAY_TP
, COUNT(CASE WHEN TO_CHAR(T1.ORD_DT,'YYYYMM') = '201701' THEN 'X' END) ORD_CNT_1701
, COUNT(CASE WHEN TO_CHAR(T1.ORD_DT,'YYYYMM') = '201702' THEN 'X' END) ORD_CNT_1702
, COUNT(CASE WHEN TO_CHAR(T1.ORD_DT,'YYYYMM') = '201703' THEN 'X' END) ORD_CNT_1703
, COUNT(CASE WHEN TO_CHAR(T1.ORD_DT,'YYYYMM') = '201704' THEN 'X' END) ORD_CNT_1704
, COUNT(CASE WHEN TO_CHAR(T1.ORD_DT,'YYYYMM') = '201705' THEN 'X' END) ORD_CNT_1705
FROM T_ORD T1
WHERE T1.ORD_ST = 'COMP'
GROUP BY T1.PAY_TP